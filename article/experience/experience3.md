# 零基础前端成长攻略「三」

## 5 提升

转正之后，我也如愿迎来了职业生涯中的第一次项目重构。

### 5.1 重构开始

我负责的微店项目，新出了一套视觉设计。涉及包括首页在内的 4 个一级页面，以及一个重要模块。由于任务量比较大，**同事X**也完成了之前的任务，因此回到了微店项目中。

按照常规做法，算是多个页面的更新。但是涉及的页面经过多次迭代之后，实际上已经冗余不堪，新版和老版视觉之间差异较大。项目原有的，差不多一年前构建的 gulp + jQuery 技术栈已经远不满足现状。

因此，在征得领导同意后，我和**同事X**决定使用 vue 框架开发新版页面。不过需要解决以下问题：

- 新旧版本页面之间的数据交互
  在 vue 框架中，页面通过路由切换，可以使用 vuex。但是跳转到老版页面时，相当于进行一次刷新，无可避免的会丢失所有 vuex 状态。初期考虑过通过 sessionStorage 暂存，不过实际上，各个老页面中已经存在有许多读取 sessionStorage 的操作。
  假设要使用 vuex，要么兼容，要么使用两套逻辑，因此决定不在项目中使用 vuex，按照之前的逻辑使用 sessionStorage。

- 新旧版本页面之间的样式差别
  在一开就和设计交流过，老页面有的公共样式（弹层，弹窗，加载动画）尽量复用。

- 新旧页面之间的尺寸差别
  旧页面使用的是媒体查询配合 rem 。实际上除开字体大小，多数样式使用的是 px 或者 %，页面适配性不佳。
  新页面使用我之前写的[自适应插件](https://github.com/xiajunqcy/Qiu-AutoRem)。
  新老页面之间不存在共用组件和样式，因此影响不大。
- UI 组件
  老页面没有系统的引用 UI 组件，基本属于用到什么写什么。组件之间关联性小，难以复用。
  综合考虑之后，决定引入 [mint-ui](https://mint-ui.github.io/#!/zh-cn) 作为新页面的 ui。

这些问题解决之后，剩下的基本都是业务逻辑上的东西，没有什么难度。略过。

> 整理出来的框架 [vue-normal](https://github.com/xiajunqcy/project/tree/master/vue-normal)

**复盘：** 如果有机会，一定要多参与项目重构，搭框架之类的任务。这样才有更多机会了解深前端工程化的知识。

### 5.2 持续集成

详细介绍一下我们是如何部署代码的。

部门统一使用 SVN 做版本控制，代码上线需要经过以下环境：
本地开发 -> 测试 -> 验收 -> 准生产 -> 正式

只有测试环境的代码 ，开发可以随意更改。后续环境，必须由 svn 提交代码之后，通过 Jenkins 从低到高依次部署才行。

准生产，和正式，更是只有运维可以部署。

对于后端来说，任务开发的流程是：

1. 在本地写代码，完成之后附带任务 id 提交。
2. 通过 Jenkins ，拉取指定 id 下的代码到下一级环境。
3. 打包，处理，运行。

相当于，同时开发多个任务的时候，只有指定的任务会被部署。不同环境的代码根据任务进度也不同。

前端在使用 vue 框架之前，虽然有通过 webpack 和 gulp 打包。但是都是基于单独页面的，互不影响。打包之后的代码也能正常比对。

相当于后端的流程，去掉第三步。同意是只部署指定任务。

但是在使用 vue 框架之后，前端代码也必须打包之后才能正常运行。而且由于打包之后生成的是一个整体文件，所以每次打包，本地环境的所有改变同样会打包进去。

在如何处理这个问题上，着实踩了不少坑。

#### 5.2.1 手动控制

因为 Jenkins 只配置有后台的打包，对前端文件相当于只是复制，粘贴到

假设现在有 A, B 两个任务，A 任务需要这周上线，B 任务不需要。